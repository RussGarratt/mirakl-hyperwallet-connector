== Seller onboarding 
=== Overview

Sellers are trading entities that sell products and services via their online shops on a Mirakl marketplace managed by a marketplace Operator. A Seller can represent an individual, if trading as a person, or a business entity, if trading as a company. For the purpose of this guide, Sellers are equivalent to Mirakl shops/stores.

For sellers that create multiple shops in Mirakl for selling with multiple currencies, each shop must be treated as a new entity. Each shop has its own account holder and needs to be onboarded separately.

Seller information is managed in the Mirakl marketplace, which is the source of all Seller data, including the details used for the Payout. Each Seller must have a corresponding user account and bank account in Hyperwallet in order to receive payments from the Mirakl marketplace Operator.

The following section describes onboarding of Sellers from Mirakl to Hyperwallet via the HMC. This includes creation and update of Seller accounts and their corresponding bank accounts through a set of automated synchronisation jobs performed by the HMC at regular configurable intervals.

Onboarding of marketplace Operators and the payee verification process for Operators are not part of the current HMC scope and are not covered by this document. For these and other out-of-scope topics, Hyperwallet will provide a parallel solution to the marketplace Operators.

=== Create/Update Seller
==== Overview

HMC provides two jobs to perform creation of new sellers and update of existing sellers:

* Professional sellers extract – extracts all business sellers from Mirakl.
* Individual sellers extract – extracts all individual sellers from Mirakl.

These are implemented as two separate jobs because the data model and behaviours in Mirakl & Hyperwallet are different between individual sellers and business sellers.

These jobs are scheduled to run on a configurable frequency. Refer to section 3.2.4 link:#timed-job-frequency[+++Timed Job Frequency+++] below for further information about configuring the timed jobs.

In the Contact Details section in the Mirakl seller page, the “Professional” boolean attribute is used to determine the seller type.

Upon successful creation of a seller’s user account in Hyperwallet:

* The user account can be found under the Account listing screen in Hyperwallet.
* The user account token will be stored under the corresponding seller’s shop record in Mirakl – see section 7.5.1 link:#seller-custom-fields[+++Seller/Store Custom Fields+++]. 
 *Note:* this field can only be viewed by the marketplace Operator and will be hidden for Sellers.

*+++T&C Acceptance+++*

The HMC will only create Hyperwallet payee accounts for new sellers when the sellers have accepted the Hyperwallet Terms & Conditions in Mirakl. If T&Cs are not accepted the rest of this guide does not apply.

Acceptance is confirmed by setting the “Hyperwallet Ts & Cs and Privacy Policy consent” custom field to “Yes”.

==== REST API Endpoints

[width="100%",cols="16%,14%,70%",options="header",]
|===
|Platform |Endpoint |Documentation
|Mirakl |(GET) S20 |https://help.mirakl.net/help/api-doc/operator/mmp.html#S20[+++help.mirakl.net/help/api-doc/operator/mmp.html#S20+++]
|Hyperwallet |(POST) Create User |http://docs.hyperwallet.com/content/api/v4/resources/users/create[+++docs.hyperwallet.com/content/api/v4/resources/users/create+++]
|Hyperwallet |(PUT) Update User |https://docs.hyperwallet.com/content/api/v4/resources/users/update[+++docs.hyperwallet.com/content/api/v4/resources/users/{token}+++]
|===

==== Data Requirements

*+++Countries & Currencies+++*

Refer to 3.3 link:#_heading=h.19c6y18[+++Create/Update Seller Bank Account+++] below regarding supported bank account types.

*+++Data mapping+++*

The following data is used by the HMC when replicating seller accounts from Mirakl into Hyperwallet.

All fields are required except where explicitly stated.

Note that different fields are replicated depending on whether the seller is of the Business or Individual type.

[width="100%",cols="28%,41%,13%,18%",options="header"]
|===
|Hyperwallet field |Mirakl field |Notes |Mirakl Custom field Type
4+|*Both Business & Individual sellers*
|clientUserId |shopId – autogenerated when creating a shop in Mirakl | |
|profileType |profileType - Check “Professional” for Business Seller type or leave unchecked for an Individual seller type. |  | 
|email |contact_informations.email | | 
|addressLine1 |contact_informations.street1 | |
|addressLine2 |contact_informations.street2 | | 
|city |contact_informations.city | |
|stateProvince |contact_informations.state (Only 2 letter code for US) | |
|country |contact_informations.country | | 
|postalCode |contact_informations.postalCode |  | 
|programToken | |Value stored within connector | 
|businessName |shopName |  | 
4+|*Business Seller – Additional fields for Business Seller type*
|businessRegistrationId |pro_details.identification_number | |
|businessOperatingNames |pro_details.corporate_name | | 
4+|*Individual Seller – Additional fields for Individual Seller type*
|firstName |firstName: contact_informations.civility + contact_informations.firstname | |
|middleName| |Not required | 
|lastName |lastName | |
|gender | |Not required |
|phoneNumber |contact_informations.phone |  |
|mobilePhone |contact_informations.phone_secondary | |
|===

==== Timed Job Frequency

The frequency for the Individual and Professional Seller Extract jobs is configurable. By default, these jobs are scheduled to run at midnight (00.00) daily. The frequency can be changed if required, using the following Environment Variables (see README for further details such as format and default value):

* PAYPAL_HYPERWALLET_EXTRACT_SELLERS_CRON_EXPRESSION
* PAYPAL_HYPERWALLET_EXTRACT_PROFESSIONAL_SELLERS_CRON_EXPRESSION

Please note, defining a very high frequency (e.g. every few minutes) may not deliver much benefit, as Seller records are not expected to be created/updated that often by the Operator. However, it will most likely impact performance. We suggest defining the frequency to once a day, if possible.

==== Technical Flow

image:image4.jpg[Diagram Description automatically generated,width=642,height=647]

=== Create/Update Seller Bank Account
==== Overview

The following bank account schemes and currencies from Mirakl are currently supported:

* IBAN (EUR, CHF)
* U.S. ABA (USD)
* CANADIAN (USD, CAD)
* United Kingdom account (GBP)

Additional schemes and currencies are planned to be released in the future when prioritised for implementation.

The following HMC job performs creation and update of seller bank accounts:

* _Bank accounts extract_

Upon successful creation of a bank account in Hyperwallet:

* The bank account details can be found in the corresponding user account record in Hyperwallet, under _“View – Consumer Account” > “Transfer”_ tab;
* The bank account token (TRM) will be stored under the corresponding seller’s shop record in Miracle – see _“Hyperwallet Additional Custom Fields”_ section. *Note:* this field can only be viewed by the marketplace Operator and will be hidden for Sellers.

==== REST API Endpoints

[width="100%",cols="16%,17%,67%",options="header",]
|===
|Platform |Endpoint |Documentation
|Mirakl |(GET) S20 |https://help.mirakl.net/help/api-doc/operator/mmp.html#S20[+++help.mirakl.net/help/api-doc/operator/mmp.html#S20+++]
|Hyperwallet |(POST) Create Bank Account |https://docs.hyperwallet.com/content/api/v4/resources/bank-accounts/create[+++docs.hyperwallet.com/content/api/v4/resources/bank-accounts/create+++]
|===

==== Data Requirements

*+++Supported payment methods (bank account types)+++*

Each supported payment method consists of a predefined set of attributes.

Attempting to use different countries or currencies than those listed here will likely result in a failure when records are synchronised into Hyperwallet during the Seller Extract job or during Payout payment creation. Please check the logs if you encounter any unexpected errors or missing data (see link:#_heading=h.pkwqa1[+++section+++] +++7+++ for logging & the log file location).

*+++Data mapping+++*

The following data will be entered when creating Seller’s stakeholders in Mirakl and replicating it into Hyperwallet via HMC. *All fields are required except where explicitly stated*.

[width="100%",cols="29%,44%,27%",options="header",]
|===
|Hyperwallet field |Mirakl field |Notes
|"profileType": |"BUSINESS" or "INDIVIDUAL", based on "Professional" attribute |
|"transferMethodCountry": |Seller Country from contact details (using 2 char ISO code as per HW API spec) |
|"transferMethodCurrency": |currency_iso_codefield from S20 API |
|"type": |N/A |Fixed value “BANK_ACCOUNT” – will be automatically added to the feed by HMC
|"businessName": |“Company name” field under Seller Contact Details |
|"country": |“Country” field under Seller Contact Details |
|"addressLine1": |“Address” field under Seller Contact Details |
|"addressLine2" |“Address (continued)” field under Seller Contact details. |This is optional and should be passed if this data exists.
|"city": |“City” field in Seller Bank Account Details |
|“postalCode”: |“Postcode” field in Seller Bank Account Details |
|“stateProvince”: |Custom field: hw-bankaccount-state. |See custom field setup guidance in Section 7.5.
|"bankAccountRelationship": "OWN_COMPANY" |N/A |This field will not be sent.
|IBAN Payment method | |
|"bankId": |BIC |
|"bankAccountId" |IBAN |
|UK Payment Method | |
|"bankId": |BIC |
|"bankAccountId" |IBAN |
|U.S. ABA Payment method | |
|branchId |Routing number (ABA). |
|bankAccountId |Bank account number |
|bankAccountPurpose |N/A |Fixed value “CHECKING” – will be automatically added to the feed by HMC
|U.S. ABA Payment method | |
|bankId |3 digit bank code |
|branchId |5 digit transit number |
|bankAccountId |Bank account number |
|===

==== Timed Job Frequency

As with Seller extract jobs, this job is scheduled to run at certain configurable frequency, by default at 00.30 AM.

The frequency of the Bank account extract job is configured by the following Environment Variable (see README for further details such as format and default value):

* PAYPAL_HYPERWALLET_BANK_ACCOUNT_EXTRACT_CRON_EXPRESSION

Please note, defining a very high frequency (e.g. every minute) may not deliver much benefit, as Seller records are not expected to be created/updated that often by the Operator. However, it will most likely impact performance. We suggest defining the frequency no higher than once a day, if possible.

==== Technical Flow

image:image5.jpg[Diagram Description automatically generated,width=642,height=531]